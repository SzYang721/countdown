<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .time-unit {
            background: black;
            color: white;
            border-radius: 8px;
            padding: 16px 24px;
            text-align: center;
        }
        .time-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .time-label {
            font-size: 1rem;
            opacity: 0.8;
        }
        @media (max-width: 768px) {
            .time-number {
                font-size: 2rem;
            }
        }
        
        /* Background image styles */
        .background-container {
            position: relative;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 0.5s ease-in-out;
        }
        
        .image-dropzone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .image-dropzone:hover {
            border-color: #007bff;
        }
        
        .image-dropzone.dragover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }
        
        .image-preview {
            display: inline-block;
            margin: 5px;
            position: relative;
        }
        
        .image-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .image-preview .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div id="app">
        <!-- Main form will be inserted here -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script>
        // Simple UUID generator
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // Countdown data storage
        const STORAGE_KEY = 'countdowns';
        const IMAGES_KEY = 'backgroundImages';
        const IMAGE_INTERVAL_KEY = 'imageInterval';
        
        // Get countdowns from localStorage
        function getStoredCountdowns() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                return stored ? JSON.parse(stored) : [];
            } catch (error) {
                console.error('Error reading from localStorage:', error);
                return [];
            }
        }
        
        // Save countdowns to localStorage
        function saveCountdowns(countdowns) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(countdowns));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }
        
        // Get background images from localStorage
        function getBackgroundImages() {
            try {
                const stored = localStorage.getItem(IMAGES_KEY);
                return stored ? JSON.parse(stored) : [];
            } catch (error) {
                console.error('Error reading images from localStorage:', error);
                return [];
            }
        }
        
        // Save background images to localStorage
        function saveBackgroundImages(images) {
            try {
                localStorage.setItem(IMAGES_KEY, JSON.stringify(images));
            } catch (error) {
                console.error('Error saving images to localStorage:', error);
            }
        }
        
        // Get image interval from localStorage
        function getImageInterval() {
            try {
                const stored = localStorage.getItem(IMAGE_INTERVAL_KEY);
                return stored ? parseInt(stored) : 5; // Default 5 seconds
            } catch (error) {
                return 5;
            }
        }
        
        // Save image interval to localStorage
        function saveImageInterval(interval) {
            try {
                localStorage.setItem(IMAGE_INTERVAL_KEY, interval.toString());
            } catch (error) {
                console.error('Error saving image interval:', error);
            }
        }
        
        // Create a new countdown
        function createCountdown(countdown) {
            const id = generateUUID();
            const now = new Date().toISOString();
            
            const fullCountdown = {
                id,
                ...countdown,
                createdAt: now,
                updatedAt: now,
            };
            
            const countdowns = getStoredCountdowns();
            countdowns.push(fullCountdown);
            saveCountdowns(countdowns);
            
            return id;
        }
        
        // Get a countdown by ID
        function getCountdown(id) {
            const countdowns = getStoredCountdowns();
            return countdowns.find(c => c.id === id) || null;
        }
        
        // Update a countdown
        function updateCountdown(id, updates) {
            const countdowns = getStoredCountdowns();
            const index = countdowns.findIndex(c => c.id === id);
            
            if (index === -1) throw new Error('Countdown not found');
            
            const now = new Date().toISOString();
            countdowns[index] = {
                ...countdowns[index],
                ...updates,
                updatedAt: now,
            };
            
            saveCountdowns(countdowns);
        }
        
        // Delete a countdown
        function deleteCountdown(id) {
            const countdowns = getStoredCountdowns();
            const filtered = countdowns.filter(c => c.id !== id);
            saveCountdowns(filtered);
        }
        
        // Calculate time remaining
        function calculateTimeRemaining(countdown) {
            const now = new Date();
            const target = new Date(countdown.targetDate);
            
            if (countdown.countType === 'natural') {
                return calculateNaturalTime(now, target);
            } else {
                return calculateWorkingTime(now, target, countdown.workingHours);
            }
        }
        
        function calculateNaturalTime(now, target) {
            const diff = target.getTime() - now.getTime();
            
            if (diff <= 0) {
                return { days: 0, hours: 0, minutes: 0, seconds: 0, isExpired: true };
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            return { days, hours, minutes, seconds, isExpired: false };
        }
        
        function calculateWorkingTime(now, target, workingHours) {
            if (!workingHours) {
                return calculateNaturalTime(now, target);
            }
            
            // Simplified working time calculation
            // For now, just use natural time
            return calculateNaturalTime(now, target);
        }
        
        // Timezone options
        const timezoneOptions = [
            { value: 'UTC', label: 'UTC' },
            { value: 'America/New_York', label: 'Eastern Time (US)' },
            { value: 'America/Chicago', label: 'Central Time (US)' },
            { value: 'America/Denver', label: 'Mountain Time (US)' },
            { value: 'America/Los_Angeles', label: 'Pacific Time (US)' },
            { value: 'Europe/London', label: 'London' },
            { value: 'Europe/Paris', label: 'Paris' },
            { value: 'Europe/Berlin', label: 'Berlin' },
            { value: 'Asia/Tokyo', label: 'Tokyo' },
            { value: 'Asia/Shanghai', label: 'Shanghai' },
            { value: 'Asia/Hong_Kong', label: 'Hong Kong' },
            { value: 'Australia/Sydney', label: 'Sydney' },
        ];
        
        // Font options
        const fontOptions = [
            { value: 'Arial, sans-serif', label: 'Arial' },
            { value: 'Georgia, serif', label: 'Georgia' },
            { value: 'Times New Roman, serif', label: 'Times New Roman' },
            { value: 'Helvetica, sans-serif', label: 'Helvetica' },
            { value: 'Verdana, sans-serif', label: 'Verdana' },
            { value: 'Courier New, monospace', label: 'Courier New' },
            { value: 'Impact, sans-serif', label: 'Impact' },
            { value: 'Comic Sans MS, cursive', label: 'Comic Sans MS' },
        ];
        
        // Main app state
        let currentView = 'form'; // 'form' or 'countdown'
        let currentCountdown = null;
        let timeRemaining = null;
        let backgroundImages = [];
        let currentImageIndex = 0;
        let imageInterval = 5; // seconds
        let imageTimer = null;
        
        // Background image management
        function loadBackgroundImages() {
            backgroundImages = getBackgroundImages();
            imageInterval = getImageInterval();
        }
        
        function saveBackgroundImagesToStorage() {
            saveBackgroundImages(backgroundImages);
        }
        
        async function addBackgroundImage(file) {
            try {
                let processedFile = file;
                
                // Check if it's a HEIC/HEIF file that needs conversion
                if (file.type === 'image/heic' || file.type === 'image/heif' || 
                    file.name.toLowerCase().endsWith('.heic') || file.name.toLowerCase().endsWith('.heif')) {
                    
                    console.log('Converting HEIC/HEIF file:', file.name);
                    
                    // Convert HEIC to JPEG using heic2any
                    const convertedBlob = await heic2any({
                        blob: file,
                        toType: 'image/jpeg',
                        quality: 0.8
                    });
                    
                    // heic2any returns an array, take the first element
                    processedFile = convertedBlob[0];
                    console.log('HEIC conversion successful');
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        id: generateUUID(),
                        data: e.target.result,
                        name: file.name // Keep original name
                    };
                    backgroundImages.push(imageData);
                    saveBackgroundImagesToStorage();
                    updateImagePreviews(); // Only update image previews, not the entire form
                };
                reader.readAsDataURL(processedFile);
                
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Error processing image: ' + error.message);
            }
        }
        
        function removeBackgroundImage(imageId) {
            backgroundImages = backgroundImages.filter(img => img.id !== imageId);
            saveBackgroundImagesToStorage();
            updateImagePreviews(); // Only update image previews, not the entire form
        }
        
        function updateImagePreviews() {
            const imagePreviews = document.getElementById('imagePreviews');
            if (!imagePreviews) return;
            
            // Update image previews
            imagePreviews.innerHTML = backgroundImages.map(img => `
                <div class="image-preview">
                    <img src="${img.data}" alt="${img.name}">
                    <button type="button" class="remove-btn" onclick="removeBackgroundImage('${img.id}')">×</button>
                </div>
            `).join('');
            
            // Update image interval section visibility
            const imageIntervalSection = document.getElementById('imageIntervalSection');
            if (imageIntervalSection) {
                if (backgroundImages.length > 1) {
                    imageIntervalSection.style.display = 'block';
                } else {
                    imageIntervalSection.style.display = 'none';
                }
            }
        }
        
        function startBackgroundImageRotation() {
            if (backgroundImages.length <= 1) return;
            
            if (imageTimer) clearInterval(imageTimer);
            
            imageTimer = setInterval(() => {
                currentImageIndex = (currentImageIndex + 1) % backgroundImages.length;
                updateBackgroundImage();
            }, imageInterval * 1000);
        }
        
        function stopBackgroundImageRotation() {
            if (imageTimer) {
                clearInterval(imageTimer);
                imageTimer = null;
            }
        }
        
        function updateBackgroundImage() {
            if (backgroundImages.length === 0) return;
            
            const currentImage = backgroundImages[currentImageIndex];
            const container = document.querySelector('.background-container');
            if (container) {
                container.style.backgroundImage = `url(${currentImage.data})`;
            }
        }
        
        // Render functions
        function renderForm() {
            loadBackgroundImages();
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen bg-gray-50 py-12 px-4">
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white rounded-lg shadow-md p-8">
                            <h1 class="text-3xl font-bold text-center mb-8 text-black">
                                Create Your Countdown
                            </h1>
                            
                            <form id="countdownForm" class="space-y-6">
                                <!-- Basic Information -->
                                <div class="space-y-4">
                                    <h2 class="text-xl font-semibold text-black">Basic Information</h2>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Event Title
                                        </label>
                                        <input
                                            type="text"
                                            required
                                            id="title"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                            placeholder="e.g., New Year 2025"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Target Date & Time
                                        </label>
                                        <input
                                            type="datetime-local"
                                            required
                                            id="targetDate"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Timezone
                                        </label>
                                        <select
                                            id="timezone"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                        >
                                            ${timezoneOptions.map(option => 
                                                `<option value="${option.value}">${option.label}</option>`
                                            ).join('')}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Location (Optional)
                                        </label>
                                        <input
                                            type="text"
                                            id="location"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                            placeholder="e.g., New York, USA"
                                        />
                                    </div>
                                </div>

                                <!-- Countdown Type -->
                                <div class="space-y-4">
                                    <h2 class="text-xl font-semibold text-black">Countdown Type</h2>
                                    
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input
                                                type="radio"
                                                name="countType"
                                                value="natural"
                                                checked
                                                class="mr-2"
                                            />
                                            Natural Time (24/7)
                                        </label>
                                        <label class="flex items-center">
                                            <input
                                                type="radio"
                                                name="countType"
                                                value="working"
                                                class="mr-2"
                                            />
                                            Working Hours Only
                                        </label>
                                    </div>
                                </div>

                                <!-- Background Images -->
                                <div class="space-y-4">
                                    <h2 class="text-xl font-semibold text-black">Background Images</h2>
                                    
                                    <div class="image-dropzone" id="imageDropzone">
                                        <p class="text-gray-600 mb-2">Drop images here or click to upload</p>
                                        <input type="file" id="imageInput" multiple accept="image/*,image/heif,image/heic,.heif,.heic" style="display: none;">
                                        <button type="button" onclick="document.getElementById('imageInput').click()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                            Choose Images
                                        </button>
                                    </div>
                                    
                                    <div id="imagePreviews" class="flex flex-wrap gap-2">
                                        ${backgroundImages.map(img => `
                                            <div class="image-preview">
                                                <img src="${img.data}" alt="${img.name}">
                                                <button type="button" class="remove-btn" onclick="removeBackgroundImage('${img.id}')">×</button>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div id="imageIntervalSection" style="display: ${backgroundImages.length > 1 ? 'block' : 'none'};">
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Image Change Interval (seconds)
                                        </label>
                                        <input
                                            type="number"
                                            id="imageInterval"
                                            min="1"
                                            max="60"
                                            value="${imageInterval}"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                        />
                                    </div>
                                </div>

                                <!-- Customization -->
                                <div class="space-y-4">
                                    <h2 class="text-xl font-semibold text-black">Customization</h2>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-black mb-2">
                                                Background Color
                                            </label>
                                            <input
                                                type="color"
                                                id="backgroundColor"
                                                value="#ffffff"
                                                class="w-full h-10 border border-gray-300 rounded-md"
                                            />
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-black mb-2">
                                                Text Color
                                            </label>
                                            <input
                                                type="color"
                                                id="textColor"
                                                value="#1a1a1a"
                                                class="w-full h-10 border border-gray-300 rounded-md"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Title Color
                                        </label>
                                        <input
                                            type="color"
                                            id="titleColor"
                                            value="#000000"
                                            class="w-full h-10 border border-gray-300 rounded-md"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Font Family
                                        </label>
                                        <select
                                            id="fontFamily"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                        >
                                            ${fontOptions.map(option => 
                                                `<option value="${option.value}">${option.label}</option>`
                                            ).join('')}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-black mb-2">
                                            Font Size
                                        </label>
                                        <select
                                            id="fontSize"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                                        >
                                            <option value="14px">Small (14px)</option>
                                            <option value="18px" selected>Medium (18px)</option>
                                            <option value="22px">Large (22px)</option>
                                            <option value="28px">Extra Large (28px)</option>
                                        </select>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    Create Countdown
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Add form submission handler
            document.getElementById('countdownForm').addEventListener('submit', handleFormSubmit);
            
            // Add image upload handlers
            setupImageUpload();
        }
        
        function setupImageUpload() {
            // Wait a bit for the DOM to be ready
            setTimeout(() => {
                const dropzone = document.getElementById('imageDropzone');
                const fileInput = document.getElementById('imageInput');
                
                if (!dropzone || !fileInput) {
                    console.error('Image upload elements not found');
                    return;
                }
                
                console.log('Setting up image upload...');
                
                // Click to upload
                dropzone.addEventListener('click', () => {
                    fileInput.click();
                });
                
                // File input change
                fileInput.addEventListener('change', async (e) => {
                    const files = Array.from(e.target.files);
                    console.log('Files selected:', files);
                    for (const file of files) {
                        if (file.type.startsWith('image/') || 
                            file.type === 'image/heif' || 
                            file.type === 'image/heic' ||
                            file.name.toLowerCase().endsWith('.heif') ||
                            file.name.toLowerCase().endsWith('.heic')) {
                            await addBackgroundImage(file);
                        }
                    }
                });
                
                // Drag and drop
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.classList.add('dragover');
                });
                
                dropzone.addEventListener('dragleave', () => {
                    dropzone.classList.remove('dragover');
                });
                
                dropzone.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    dropzone.classList.remove('dragover');
                    
                    const files = Array.from(e.dataTransfer.files);
                    console.log('Files dropped:', files);
                    for (const file of files) {
                        if (file.type.startsWith('image/') || 
                            file.type === 'image/heif' || 
                            file.type === 'image/heic' ||
                            file.name.toLowerCase().endsWith('.heif') ||
                            file.name.toLowerCase().endsWith('.heic')) {
                            await addBackgroundImage(file);
                        }
                    }
                });
            }, 100);
        }
        
        function handleFormSubmit(e) {
            e.preventDefault();
            console.log('Form submitted!');
            
            try {
                const formData = {
                    title: document.getElementById('title').value,
                    targetDate: document.getElementById('targetDate').value,
                    timezone: document.getElementById('timezone').value,
                    location: document.getElementById('location').value,
                    countType: document.querySelector('input[name="countType"]:checked').value,
                    workingHours: {
                        start: '09:00',
                        end: '17:00',
                        excludeWeekends: true,
                    },
                    customization: {
                        backgroundColor: document.getElementById('backgroundColor').value,
                        textColor: document.getElementById('textColor').value,
                        titleColor: document.getElementById('titleColor').value,
                        fontFamily: document.getElementById('fontFamily').value,
                        fontSize: document.getElementById('fontSize').value,
                    },
                };
                
                console.log('Form data collected:', formData);
                
                // Save image interval if set
                const intervalInput = document.getElementById('imageInterval');
                if (intervalInput) {
                    imageInterval = parseInt(intervalInput.value);
                    saveImageInterval(imageInterval);
                }
                
                console.log('Creating countdown with data:', formData);
                
                const id = createCountdown(formData);
                console.log('Created countdown with ID:', id);
                
                // Update URL hash to include the countdown ID
                window.location.hash = `#/countdown/${id}`;
                
                showCountdown(id);
            } catch (error) {
                console.error('Error creating countdown:', error);
                alert('Error creating countdown: ' + error.message);
            }
        }
        
        function showCountdown(id) {
            currentCountdown = getCountdown(id);
            console.log('Retrieved countdown:', currentCountdown);
            
            if (!currentCountdown) {
                alert('Countdown not found');
                return;
            }
            
            currentView = 'countdown';
            renderCountdown();
            startCountdownTimer();
        }
        
        function renderCountdown() {
            if (!currentCountdown) return;
            
            const customStyle = `
                background-color: ${currentCountdown.customization.backgroundColor};
                color: ${currentCountdown.customization.textColor};
                font-family: ${currentCountdown.customization.fontFamily};
                font-size: ${currentCountdown.customization.fontSize};
            `;
            
            const titleStyle = `
                color: ${currentCountdown.customization.titleColor};
                font-family: ${currentCountdown.customization.fontFamily};
            `;
            
            // Set background image if available
            let backgroundStyle = customStyle;
            if (backgroundImages.length > 0) {
                const currentImage = backgroundImages[currentImageIndex];
                backgroundStyle += `background-image: url(${currentImage.data}); background-size: cover; background-position: center; background-repeat: no-repeat;`;
            }
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen flex flex-col background-container" style="${backgroundStyle}">
                    <!-- Control Bar -->
                    <div class="bg-gray-100 border-b p-4 flex justify-between items-center text-black">
                        <div class="flex space-x-2">
                            <button
                                onclick="renderForm()"
                                class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700"
                            >
                                New Countdown
                            </button>
                            <button
                                onclick="copyShareUrl()"
                                class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"
                            >
                                Share URL
                            </button>
                        </div>
                        <div class="text-sm text-gray-800">
                            ID: ${currentCountdown.id}
                        </div>
                    </div>

                    <!-- Countdown Display -->
                    <div class="flex-1 flex flex-col items-center justify-center p-8">
                        <h1 class="text-4xl md:text-6xl font-bold mb-8 text-center" style="${titleStyle}">
                            ${currentCountdown.title}
                        </h1>

                        ${currentCountdown.location ? `
                            <p class="text-xl mb-8 opacity-80 text-center">
                                📍 ${currentCountdown.location}
                            </p>
                        ` : ''}

                        <div id="countdownDisplay" class="text-center">
                            <!-- Countdown will be updated here -->
                        </div>

                        <div class="mt-8 text-sm opacity-80 text-center">
                            <p>Countdown Type: ${currentCountdown.countType === 'natural' ? 'Natural Time (24/7)' : 'Working Hours Only'}</p>
                            <p>Timezone: ${currentCountdown.timezone}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Start background image rotation if multiple images
            if (backgroundImages.length > 1) {
                startBackgroundImageRotation();
            }
        }
        
        function startCountdownTimer() {
            const updateCountdown = () => {
                if (!currentCountdown) return;
                
                timeRemaining = calculateTimeRemaining(currentCountdown);
                const display = document.getElementById('countdownDisplay');
                
                if (!display) return;
                
                console.log('Time remaining:', timeRemaining);
                
                if (timeRemaining.isExpired) {
                    display.innerHTML = `
                        <div class="text-6xl md:text-8xl font-bold mb-4 animate-pulse">
                            🎉 TIME'S UP! 🎉
                        </div>
                    `;
                } else {
                    display.innerHTML = `
                        <div class="grid grid-cols-4 gap-4 md:gap-8 text-center">
                            <div class="time-unit">
                                <div class="time-number">${timeRemaining.days.toString().padStart(2, '0')}</div>
                                <div class="time-label">Days</div>
                            </div>
                            <div class="time-unit">
                                <div class="time-number">${timeRemaining.hours.toString().padStart(2, '0')}</div>
                                <div class="time-label">Hours</div>
                            </div>
                            <div class="time-unit">
                                <div class="time-number">${timeRemaining.minutes.toString().padStart(2, '0')}</div>
                                <div class="time-label">Minutes</div>
                            </div>
                            <div class="time-unit">
                                <div class="time-number">${timeRemaining.seconds.toString().padStart(2, '0')}</div>
                                <div class="time-label">Seconds</div>
                            </div>
                        </div>
                    `;
                }
            };
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
        
        function copyShareUrl() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Share URL copied to clipboard!');
            });
        }
        
        // Check if we're viewing a specific countdown
        function checkForCountdownId() {
            const hash = window.location.hash;
            if (hash && hash.startsWith('#/countdown/')) {
                const id = hash.replace('#/countdown/', '');
                showCountdown(id);
            } else {
                renderForm();
            }
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', checkForCountdownId);
        
        // Handle browser back/forward
        window.addEventListener('hashchange', checkForCountdownId);
    </script>
</body>
</html>
